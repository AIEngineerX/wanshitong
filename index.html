<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wan Shi Tong's Library ‚Äì $WanShiTong</title>
  <meta name="description" content="$WanShiTong - He Who Knows Ten Thousand Things. The wisest meme coin on Solana. Join the library of knowledge seekers.">
  <meta property="og:title" content="Wan Shi Tong's Library - $WanShiTong">
  <meta property="og:description" content="He Who Knows Ten Thousand Things now guards your bags on Solana">
  <meta property="og:image" content="https://wanshitong.xyz/wan-shi-tong.png">
  <meta name="twitter:card" content="summary_large_image">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Georgia', serif;
      /* Mystical winter/aurora background (replaces prior gradient) */
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(120, 210, 255, 0.08), transparent 60%),
        radial-gradient(900px 600px at 85% 18%, rgba(120, 255, 190, 0.06), transparent 62%),
        radial-gradient(1000px 700px at 55% 85%, rgba(255, 200, 120, 0.05), transparent 60%),
        linear-gradient(180deg, rgba(10, 14, 18, 0.98), rgba(8, 8, 10, 0.98));
      background-attachment: fixed;
      color: #e8d5b7;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    .stars {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .star {
      position: absolute;
      background: #fff;
      border-radius: 50%;
      animation: twinkle 3s infinite;
      transition: transform 0.1s ease-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.25; }
      50% { opacity: 0.9; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    header {
      text-align: center;
      padding: 60px 20px 34px;
      background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
      position: relative;
      z-index: 1;
      animation: fadeInUp 0.8s ease-out;
    }

    .owl-icon {
      width: 200px;
      height: 200px;
      margin: 0 auto 18px;
      border-radius: 50%;
      overflow: hidden;
      border: 4px solid #daa520;
      box-shadow: 0 0 30px rgba(218, 165, 32, 0.5);
      animation: float 3s ease-in-out infinite;
      position: relative;
      transition: transform 0.2s ease-out, box-shadow 0.3s ease;
      cursor: pointer;
      will-change: transform;
    }

    .owl-icon:hover {
      box-shadow: 0 0 50px rgba(218, 165, 32, 0.8);
    }

    .owl-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center top;
      display: block;
    }

    h1 {
      font-size: 3em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      letter-spacing: 3px;
      transition: text-shadow 0.3s ease;
    }

    h1:hover {
      text-shadow: 
        0 0 10px #daa520,
        0 0 20px #daa520,
        0 0 30px #daa520,
        2px 2px 4px rgba(0,0,0,0.8);
    }

    .subtitle {
      font-style: italic;
      font-size: 1.2em;
      opacity: 0.9;
      margin-bottom: 18px;
    }

    .warning {
      background: rgba(139, 0, 0, 0.3);
      border: 2px solid #8b0000;
      padding: 15px;
      max-width: 780px;
      margin: 14px auto 0;
      border-radius: 7px;
      font-size: 0.95em;
    }

    .price-ticker {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.85);
      border: 2px solid #8b6914;
      border-radius: 12px;
      padding: 16px 20px;
      backdrop-filter: blur(10px);
      z-index: 100;
      min-width: 240px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      transition: transform 0.3s ease;
    }

    .price-ticker:hover {
      transform: translateY(-4px);
      border-color: #daa520;
    }

    .ticker-title {
      font-size: 0.85em;
      opacity: 0.8;
      margin-bottom: 8px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .ticker-price {
      font-size: 1.8em;
      font-weight: bold;
      color: #daa520;
      margin-bottom: 6px;
      font-family: 'Courier New', monospace;
    }

    .ticker-change {
      font-size: 0.95em;
      font-family: 'Courier New', monospace;
    }

    .ticker-change.positive { color: #00ff88; }
    .ticker-change.negative { color: #ff4444; }

    .ticker-link {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(218,165,32,0.25);
      font-size: 0.85em;
      opacity: 0.8;
    }

    .ticker-link a {
      color: #daa520;
      text-decoration: none;
      transition: opacity 0.2s;
    }

    .ticker-link a:hover { opacity: 1; }

    .floating-particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .sand-particle {
      position: absolute;
      background: rgba(194,178,128,0.4);
      border-radius: 50%;
      animation: float-particle linear infinite;
    }

    @keyframes float-particle {
      0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
      10% { opacity: 0.6; }
      90% { opacity: 0.6; }
      100% { transform: translateY(-100vh) translateX(var(--drift)) rotate(360deg); opacity: 0; }
    }

    .spirit-wisp {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(138,43,226,0.5) 0%, rgba(138,43,226,0) 70%);
      animation: drift-wisp linear infinite;
      filter: blur(8px);
    }

    @keyframes drift-wisp {
      0% { transform: translate(0, 0) scale(1); opacity: 0; }
      10% { opacity: 0.7; }
      50% { transform: translate(var(--drift-x), var(--drift-y)) scale(1.5); }
      90% { opacity: 0.7; }
      100% { transform: translate(calc(var(--drift-x) * 2), calc(var(--drift-y) * 2)) scale(1); opacity: 0; }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 34px 20px 50px;
      position: relative;
      z-index: 1;
    }

    .lore-trigger { position: relative; }
    .lore-popover {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: calc(100% + 14px);
      width: min(560px, calc(100vw - 40px));
      background: rgba(0,0,0,0.78);
      border: 2px solid #8b6914;
      border-radius: 10px;
      padding: 18px 18px 14px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 20;
    }
    .lore-title {
      color: #daa520;
      font-weight: bold;
      letter-spacing: 1px;
      margin-bottom: 10px;
      text-transform: uppercase;
      font-size: 0.95em;
    }
    .lore-text {
      line-height: 1.6;
      font-size: 1.05em;
      color: #e8d5b7;
      min-height: 64px;
      white-space: pre-wrap;
    }
    .lore-hint {
      margin-top: 10px;
      opacity: 0.82;
      font-size: 0.9em;
      color: #e8d5b7;
      border-top: 1px solid rgba(218,165,32,0.25);
      padding-top: 10px;
    }
    .lore-trigger:hover .lore-popover,
    .lore-trigger:focus-within .lore-popover {
      opacity: 1;
      pointer-events: auto;
    }
    .lore-popover::before {
      content: "";
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%) rotate(45deg);
      width: 14px;
      height: 14px;
      background: rgba(0,0,0,0.78);
      border-left: 2px solid #8b6914;
      border-top: 2px solid #8b6914;
    }

    .token-hero { 
      margin: 0 0 26px;
      animation: fadeInUp 0.8s ease-out 0.2s both;
    }
    .token-card {
      background: rgba(61, 35, 20, 0.6);
      border: 2px solid #8b6914;
      border-radius: 12px;
      padding: 28px;
      backdrop-filter: blur(6px);
    }
    .token-row {
      display: flex;
      gap: 20px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .token-kicker {
      opacity: 0.85;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-size: 0.9em;
      margin-bottom: 6px;
    }
    .token-name {
      font-size: 2.6em;
      color: #daa520;
      letter-spacing: 3px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      transition: text-shadow 0.3s ease;
    }
    .token-name:hover {
      text-shadow: 
        0 0 10px #daa520,
        0 0 20px #daa520,
        0 0 30px #daa520,
        2px 2px 4px rgba(0,0,0,0.8);
    }
    .token-tagline { opacity: 0.95; margin-top: 6px; max-width: 70ch; }
    .token-actions { display: flex; gap: 12px; flex-wrap: wrap; }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      border-radius: 8px;
      border: 2px solid #8b6914;
      background: rgba(0,0,0,0.35);
      color: #e8d5b7;
      text-decoration: none;
      font-weight: bold;
      transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
      cursor: pointer;
      font-family: 'Georgia', serif;
    }
    .btn:hover { transform: translateY(-2px); border-color: #daa520; background: rgba(0,0,0,0.5); }
    .btn.primary { background: #8b6914; border-color: #8b6914; }
    .btn.primary:hover { background: #daa520; border-color: #daa520; }
    .btn.small { padding: 10px 14px; font-size: 0.95em; }

    .ca-box {
      margin-top: 18px;
      background: rgba(0,0,0,0.35);
      border: 2px solid rgba(218,165,32,0.35);
      border-radius: 10px;
      padding: 14px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px 12px;
      align-items: center;
    }
    .ca-label { opacity: 0.9; color: #daa520; font-weight: bold; }
    .ca-value {
      grid-column: 1 / -1;
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      word-break: break-all;
      padding: 10px;
      border-radius: 8px;
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(218,165,32,0.25);
    }
    .copy-status { opacity: 0.9; font-size: 0.9em; justify-self: end; }

    .share-row {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .token-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 14px;
      margin-top: 18px;
    }
    .stat {
      background: rgba(0,0,0,0.28);
      border: 1px solid rgba(218,165,32,0.22);
      border-radius: 10px;
      padding: 14px;
    }
    .stat-label { opacity: 0.85; font-size: 0.95em; }
    .stat-value { color: #daa520; font-weight: bold; margin-top: 6px; font-size: 1.05em; }

    .links-row {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .pill {
      display: inline-block;
      padding: 10px 14px;
      border-radius: 999px;
      border: 2px solid rgba(218,165,32,0.25);
      background: rgba(0,0,0,0.3);
      color: #e8d5b7;
      text-decoration: none;
      transition: transform 0.2s ease, border-color 0.2s ease;
    }
    .pill:hover { transform: translateY(-2px); border-color: #daa520; }

    .disclaimer {
      margin-top: 18px;
      opacity: 0.85;
      font-size: 0.95em;
      border-top: 1px solid rgba(218,165,32,0.22);
      padding-top: 14px;
    }

    .token-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 22px;
      margin: 18px 0 40px;
    }
    .panel {
      background: rgba(61, 35, 20, 0.55);
      border: 2px solid #8b6914;
      border-radius: 12px;
      padding: 22px;
      backdrop-filter: blur(5px);
      animation: fadeInUp 0.6s ease-out both;
    }
    .panel:nth-child(1) { animation-delay: 0.3s; }
    .panel:nth-child(2) { animation-delay: 0.4s; }
    .panel:nth-child(3) { animation-delay: 0.5s; }
    .panel h3 { color: #daa520; margin-bottom: 12px; font-size: 1.5em; }
    .clean-list { list-style: none; padding-left: 0; }
    .clean-list li {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(218,165,32,0.18);
    }
    .clean-list li:last-child { border-bottom: none; }
    .steps { margin-left: 18px; }
    .steps li { margin: 10px 0; line-height: 1.55; }
    .roadmap { display: grid; gap: 12px; }
    .milestone {
      padding: 12px;
      border-radius: 10px;
      background: rgba(0,0,0,0.28);
      border: 1px solid rgba(218,165,32,0.22);
      line-height: 1.55;
    }
    .milestone span {
      display: inline-block;
      margin-right: 10px;
      color: #daa520;
      font-weight: bold;
    }
    .muted { opacity: 0.9; line-height: 1.6; }

    .knowledge-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
      align-items: stretch;
      justify-items: stretch;
    }

    .section {
      background: rgba(61, 35, 20, 0.6);
      border: 2px solid #8b6914;
      border-radius: 10px;
      padding: 30px;
      transition: all 0.3s ease;
      cursor: pointer;
      backdrop-filter: blur(5px);
      min-height: 270px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      animation: fadeInUp 0.6s ease-out both;
    }

    .section:nth-child(1) { animation-delay: 0.6s; }
    .section:nth-child(2) { animation-delay: 0.7s; }
    .section:nth-child(3) { animation-delay: 0.8s; }

    .section:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(139, 105, 20, 0.4);
      border-color: #daa520;
    }

    .section h2 {
      color: #daa520;
      margin-bottom: 8px;
      font-size: 1.8em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-icon { font-size: 1.3em; }
    .section-icon svg{
      width: 22px;
      height: 22px;
      stroke: #daa520;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity: 0.9;
      transition: all 0.2s ease;
    }
    .section:hover .section-icon svg{
      opacity: 1;
      transform: translateY(-1px);
    }
    .section p { line-height: 1.6; opacity: 0.9; margin-top: 0; }

    .quote-section {
      background: rgba(0, 0, 0, 0.5);
      border-left: 4px solid #daa520;
      padding: 30px;
      margin: 50px 0;
      border-radius: 5px;
      animation: fadeInUp 0.6s ease-out 0.9s both;
    }

    .quote {
      font-size: 1.3em;
      font-style: italic;
      text-align: center;
      margin-bottom: 15px;
      line-height: 1.6;
    }

    .quote-author {
      text-align: right;
      color: #daa520;
      font-weight: bold;
    }

    .knowledge-form {
      background: rgba(61, 35, 20, 0.6);
      border: 2px solid #8b6914;
      border-radius: 10px;
      padding: 40px;
      max-width: 720px;
      margin: 50px auto 30px;
      animation: fadeInUp 0.6s ease-out 1s both;
    }

    .knowledge-form h3 {
      color: #daa520;
      margin-bottom: 14px;
      font-size: 1.8em;
      text-align: center;
    }

    .form-group { margin-bottom: 20px; }
    label {
      display: block;
      margin-bottom: 8px;
      color: #daa520;
      font-weight: bold;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid #8b6914;
      border-radius: 5px;
      color: #e8d5b7;
      font-family: 'Georgia', serif;
      font-size: 1em;
    }

    input:focus, textarea:focus { outline: none; border-color: #daa520; }
    textarea { resize: vertical; min-height: 120px; }

    button {
      background: #8b6914;
      color: #e8d5b7;
      border: none;
      padding: 15px 40px;
      font-size: 1.1em;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Georgia', serif;
      width: 100%;
      font-weight: bold;
    }

    button:hover {
      background: #daa520;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(218, 165, 32, 0.4);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(232, 213, 183, 0.3);
      border-top-color: #e8d5b7;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .submission-message {
      background: rgba(0, 0, 0, 0.55);
      border: 2px solid rgba(218, 165, 32, 0.35);
      padding: 15px;
      border-radius: 8px;
      margin-top: 18px;
      text-align: left;
      display: none;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    /* PFP Generator specific styles */
    .pfp-controls { display: grid; gap: 16px; }
    .control-group { display: flex; flex-direction: column; gap: 8px; }
    .control-group label { font-size: 0.95em; margin-bottom: 4px; }
    .button-row { display: flex; gap: 8px; flex-wrap: wrap; }
    .preset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }

    .preset-btn {
      aspect-ratio: 1;
      background: rgba(0,0,0,0.4);
      border: 2px solid #8b6914;
      border-radius: 8px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 0.85em;
      color: #e8d5b7;
      text-align: center;
    }

    .preset-btn:hover { border-color: #daa520; transform: scale(1.05); }
    .preset-icon { font-size: 1.5em; }

    input[type="range"] {
      width: 100%;
      height: 6px;
      background: rgba(0,0,0,0.4);
      border: 1px solid #8b6914;
      border-radius: 3px;
      outline: none;
      padding: 0;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      background: #daa520;
      border-radius: 50%;
      cursor: pointer;
    }
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #daa520;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .undo-redo { display: flex; gap: 8px; }

    footer {
      text-align: center;
      padding: 40px 20px;
      opacity: 0.7;
      font-size: 0.9em;
      z-index: 1;
      position: relative;
    }

    @media (max-width: 768px) {
      .token-actions { width: 100%; }
      .token-actions .btn { flex: 1; min-width: 140px; }
      .ca-box { grid-template-columns: 1fr; }
      .section { min-height: auto; }
      .price-ticker { bottom: 10px; right: 10px; min-width: 200px; padding: 12px 16px; }
      .ticker-price { font-size: 1.5em; }
      #pfpGen > div > div > div:first-child { grid-template-columns: 1fr !important; }
    }

    @media (max-width: 520px) {
      h1 { font-size: 2.2em; }
      .token-name { font-size: 2.1em; }
      .token-card { padding: 22px; }
    }
  

    /* =========================================================
       Mystical Snow Overlay (site-wide)
       ========================================================= */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      opacity: 0.55;
      background-image:
        radial-gradient(circle, rgba(255,255,255,0.55) 1px, transparent 1.6px),
        radial-gradient(circle, rgba(255,255,255,0.35) 1px, transparent 1.7px),
        radial-gradient(circle, rgba(255,255,255,0.25) 1px, transparent 1.8px);
      background-size: 120px 120px, 180px 180px, 260px 260px;
      filter: blur(0.2px);
      animation: snowFallA 38s linear infinite;
    }

    body::after {
      content: "";
      position: fixed;
      inset: -20%;
      pointer-events: none;
      z-index: 0;
      opacity: 0.35;
      background-image:
        radial-gradient(circle, rgba(255,255,255,0.35) 2px, transparent 3px),
        radial-gradient(circle at 30% 40%, rgba(120, 210, 255, 0.08), transparent 40%),
        radial-gradient(circle at 70% 30%, rgba(120, 255, 190, 0.06), transparent 42%);
      background-size: 320px 320px, 900px 900px, 1100px 1100px;
      mix-blend-mode: screen;
      filter: blur(0.6px);
      animation: snowFallB 55s linear infinite, auroraDrift 18s ease-in-out infinite;
    }

    /* Keep content above overlays */
    body > * {
      position: relative;
      z-index: 1;
    }

    @keyframes snowFallA {
      from { background-position: 0 -200px, 0 -400px, 0 -600px; }
      to   { background-position: 0 1200px, 0 1600px, 0 2000px; }
    }

    @keyframes snowFallB {
      from { background-position: 0 -300px, 0 -700px, 0 -900px; }
      to   { background-position: 0 1500px, 0 1900px, 0 2400px; }
    }

    @keyframes auroraDrift {
      0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
      50%      { transform: translate3d(2%, 1%, 0) scale(1.02); }
    }

    /* ===== Meme Library (fit all aspect ratios) ===== */
    .meme-frame{
      width: 100%;
      max-width: 900px;
      aspect-ratio: 16 / 9;
      margin: 0 auto;
      border-radius: 14px;
      overflow: hidden;
      border: 2px solid #8b6914;
      background: rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .meme-frame img{
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }
    .meme-actions{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      justify-content:center;
      margin-top: 14px;
    }
    .sigil-wrap{
      width: 100%;
      max-width: 520px;
      margin: 0 auto;
      border-radius: 14px;
      overflow: hidden;
      border: 2px solid #8b6914;
      background: rgba(0,0,0,0.35);
      box-shadow: 0 0 30px rgba(218,165,32,0.18);
    }
    .sigil-wrap img{ width: 100%; display:block; }
    .sigil-wrap img.awakened{ filter: drop-shadow(0 0 14px rgba(255,60,60,0.55)); }


/* ===== Spirit Run (Mini Game) ===== */
.wst-game{
  border: 1px solid rgba(139,105,20,0.55);
  border-radius: 14px;
  padding: 14px;
  background: rgba(0,0,0,0.22);
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
}
.wst-game-head{
  display:flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}
.wst-game-title{
  font-weight: 800;
  letter-spacing: 0.4px;
  font-size: 18px;
  color: #f6d57a;
  text-shadow: 0 0 18px rgba(246,213,122,0.25);
}
.wst-game-actions{ display:flex; gap: 8px; flex-wrap: wrap; }
#wstGameCanvas{
  width: 100%;
  height: auto;
  display:block;
  border-radius: 12px;
  border: 2px solid rgba(139,105,20,0.85);
  background: radial-gradient(1200px 360px at 50% 0%, rgba(90,145,255,0.12), rgba(0,0,0,0.35)),
              linear-gradient(180deg, rgba(20,20,28,0.55), rgba(10,10,12,0.55));
}
.wst-game-hud{
  display:flex;
  justify-content: space-between;
  gap: 10px;
  align-items:center;
  flex-wrap: wrap;
  margin-top: 10px;
  font-size: 13px;
}
  
/* === WST Portal Overlay (additive) === */
.wst-portal-btn{
  position: fixed;
  left: 18px;
  bottom: 18px;
  z-index: 9998;
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid rgba(178, 134, 48, 0.55);
  background: rgba(0,0,0,0.55);
  color: var(--gold, #d4a52b);
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  cursor: pointer;
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
  backdrop-filter: blur(6px);
}
.wst-portal-btn:hover{ background: rgba(0,0,0,0.7); }

.wst-portal{
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: none;
}
.wst-portal[aria-hidden="false"]{ display:block; }

.wst-portal-backdrop{
  position:absolute; inset:0;
  background:
    radial-gradient(900px 520px at 50% 20%, rgba(122,255,192,0.10), transparent 60%),
    radial-gradient(900px 520px at 20% 70%, rgba(120,210,255,0.09), transparent 60%),
    rgba(0,0,0,0.72);
  backdrop-filter: blur(8px);
}

.wst-portal-shell{
  position: relative;
  width: min(1100px, calc(100% - 24px));
  height: min(720px, calc(100% - 24px));
  margin: 12px auto;
  border-radius: 18px;
  border: 1px solid rgba(178,134,48,0.55);
  background: rgba(10,7,4,0.86);
  box-shadow: 0 20px 60px rgba(0,0,0,0.55);
  overflow: hidden;
}

.wst-portal-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  padding: 14px 16px;
  border-bottom: 1px solid rgba(178,134,48,0.25);
}
.wst-portal-title{
  display:flex; flex-direction:column; gap:4px;
}
.wst-portal-title strong{
  color: var(--gold, #d4a52b);
  letter-spacing: 0.08em;
}
.wst-portal-title span{ opacity:0.8; font-size: 12px; }

.wst-portal-close{
  border: 1px solid rgba(178,134,48,0.45);
  background: rgba(0,0,0,0.35);
  color: #eee;
  border-radius: 12px;
  padding: 8px 10px;
  cursor:pointer;
}

.wst-portal-body{
  display:grid;
  grid-template-columns: 220px 1fr;
  height: calc(100% - 58px);
}
.wst-portal-tabs{
  border-right: 1px solid rgba(178,134,48,0.2);
  padding: 12px;
  overflow:auto;
}
.wst-portal-tab{
  width:100%;
  text-align:left;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(178,134,48,0.25);
  background: rgba(0,0,0,0.25);
  color: #eae3d6;
  cursor:pointer;
  margin-bottom: 10px;
}
.wst-portal-tab[aria-selected="true"]{
  background: rgba(178,134,48,0.14);
  border-color: rgba(178,134,48,0.55);
}
.wst-portal-content{
  padding: 14px;
  overflow:auto;
}
.wst-portal-note{
  font-size: 12px;
  opacity: 0.75;
  margin-top: 8px;
  line-height: 1.4;
}

.wst-vault-card{
  border: 1px solid rgba(178,134,48,0.35);
  border-radius: 14px;
  background: rgba(0,0,0,0.30);
  padding: 14px;
}
.wst-vault-actions{
  display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;
}
.wst-mini-btn{
  border: 1px solid rgba(178,134,48,0.45);
  background: rgba(0,0,0,0.35);
  color: #eae3d6;
  border-radius: 12px;
  padding: 8px 10px;
  cursor:pointer;
}
.wst-mini-btn:hover{ background: rgba(178,134,48,0.12); }

@media (max-width: 860px){
  .wst-portal-body{ grid-template-columns: 1fr; }
  .wst-portal-tabs{ display:flex; gap:10px; border-right:0; border-bottom:1px solid rgba(178,134,48,0.2); }
  .wst-portal-tab{ margin-bottom:0; white-space:nowrap; }
}


/* Parallax (non-destructive) */
#floatingParticles{
  transform: translate(var(--wst-parallax-x, 0px), var(--wst-parallax-y, 0px));
  transition: transform 120ms linear;
}

/* === Portal Intensity Upgrade (additive overrides) === */
.wst-portal-btn{
  padding: 12px 16px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.48));
  border-color: rgba(218,165,32,0.70);
  box-shadow:
    0 14px 40px rgba(0,0,0,0.45),
    0 0 0 1px rgba(218,165,32,0.18),
    0 0 22px rgba(218,165,32,0.22),
    0 0 46px rgba(255,60,60,0.08);
  animation: wstPortalPulse 2.4s ease-in-out infinite;
}
.wst-portal-btn::before{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius: 18px;
  background:
    radial-gradient(circle at 50% 50%, rgba(255,60,60,0.12), transparent 55%),
    conic-gradient(from 90deg, rgba(218,165,32,0.22), rgba(120,210,255,0.10), rgba(122,255,192,0.10), rgba(218,165,32,0.22));
  filter: blur(10px);
  z-index:-1;
}
.wst-portal-btn:hover{
  transform: translateY(-1px);
  box-shadow:
    0 16px 48px rgba(0,0,0,0.52),
    0 0 0 1px rgba(218,165,32,0.22),
    0 0 30px rgba(218,165,32,0.30),
    0 0 70px rgba(255,60,60,0.12);
}

@keyframes wstPortalPulse{
  0%,100% { filter: brightness(1); }
  50%     { filter: brightness(1.12); }
}

.wst-portal-backdrop{
  background:
    radial-gradient(980px 560px at 50% 18%, rgba(255,60,60,0.10), transparent 58%),
    radial-gradient(900px 520px at 50% 20%, rgba(122,255,192,0.10), transparent 60%),
    radial-gradient(900px 520px at 20% 70%, rgba(120,210,255,0.09), transparent 60%),
    rgba(0,0,0,0.78);
}

.wst-portal-shell{
  box-shadow:
    0 40px 120px rgba(0,0,0,0.72),
    0 0 0 1px rgba(218,165,32,0.14),
    0 0 60px rgba(255,60,60,0.08);
  border-color: rgba(218,165,32,0.25);
  transform: translateY(10px) scale(0.985);
  opacity: 0.0;
}

.wst-portal.open .wst-portal-shell{
  animation: wstPortalEnter 420ms ease-out forwards;
}

@keyframes wstPortalEnter{
  from { transform: translateY(18px) scale(0.975); opacity: 0; }
  to   { transform: translateY(0px) scale(1.0); opacity: 1; }
}

/* Make portal feel tighter / fewer things */
.wst-portal-title span{
  opacity: 0.78;
}
</style>
</head>

<body>
  <div class="stars" id="stars"></div>
  <div class="floating-particles" id="floatingParticles"></div>

  <div class="price-ticker" id="priceTicker">
    <div class="ticker-title">$WanShiTong</div>
    <div class="ticker-price" id="tickerPrice">Loading...</div>
    <div class="ticker-change" id="tickerChange">--</div>
    <div class="ticker-link">
      <a href="https://dexscreener.com/solana/gb1dccxamrtdcw1zhhd6nu3mrdxalzdgyld8qfcr2mwn" target="_blank" rel="noopener noreferrer">View Chart ‚Üí</a>
    </div>
  </div>

  <header>
    <div class="owl-icon lore-trigger" id="loreTrigger" tabindex="0">
      <img src="wan-shi-tong.png" alt="Wan Shi Tong" />
      <div class="lore-popover" id="lorePopover" aria-hidden="true">
        <div class="lore-title">The Knowledge Spirit Speaks</div>
        <div class="lore-text" id="loreText"></div>
        <div class="lore-hint">Hover to hear the ancient wisdom. Click for more.</div>
      </div>
    </div>

    <h1>WAN SHI TONG</h1>
    <p class="subtitle">He Who Knows Ten Thousand Things</p>
    <div class="warning">‚ö†Ô∏è Those who seek knowledge for destructive purposes will be cast out into the desert</div>
  </header>

  <div class="container">

    <section class="token-hero">
      <div class="token-card">
        <div class="token-row">
          <div>
            <div class="token-kicker">The Library Opens</div>
            <div class="token-name">$WanShiTong</div>
            <div class="token-tagline">The ancient Knowledge Spirit who guards the greatest library in existence. Once buried beneath the Si Wong Desert, now protecting your portfolio with ten thousand years of wisdom.</div>
          </div>

          <div class="token-actions">
            <a class="btn primary" href="https://jup.ag/swap/SOL-DzmMSKtWmc2vhDxEcD5EH5Qr1MZNYJYZ8uE3UHaxpump" target="_blank" rel="noopener noreferrer">Buy on Jupiter</a>
            <a class="btn" href="https://dexscreener.com/solana/gb1dccxamrtdcw1zhhd6nu3mrdxalzdgyld8qfcr2mwn" target="_blank" rel="noopener noreferrer">View Chart</a>
          </div>
        </div>

        <div class="ca-box">
          <div class="ca-label">Contract Address</div>
          <div class="ca-value" id="caValue">DzmMSKtWmc2vhDxEcD5EH5Qr1MZNYJYZ8uE3UHaxpump</div>
          <button class="btn small" type="button" id="copyCa">Copy</button>
          <span class="copy-status" id="copyStatus" aria-live="polite"></span>
        </div>

        <div class="share-row">
          <button class="btn small" type="button" id="shareTwitter">Share on ùïè</button>
          <button class="btn small" type="button" id="copyLink">Copy Link</button>
        </div>

        <div class="token-stats">
          <div class="stat">
            <div class="stat-label">Chain</div>
            <div class="stat-value">Solana</div>
          </div>
          <div class="stat">
            <div class="stat-label">Supply</div>
            <div class="stat-value">1,000,000,000</div>
          </div>
          <div class="stat">
            <div class="stat-label">Tax</div>
            <div class="stat-value">0/0</div>
          </div>
          <div class="stat">
            <div class="stat-label">LP</div>
            <div class="stat-value">Burned / Locked</div>
          </div>
        </div>

        <div class="links-row">
          <a class="pill" href="https://x.com/i/communities/2002918673451831748" target="_blank" rel="noopener noreferrer">ùïè / Community</a>
          <a class="pill" href="https://dexscreener.com/solana/gb1dccxamrtdcw1zhhd6nu3mrdxalzdgyld8qfcr2mwn" target="_blank" rel="noopener noreferrer">Dexscreener</a>
        </div>

        <div class="disclaimer">
          <strong>Wan Shi Tong warns:</strong> I do not help those who seek knowledge for war or personal gain. The library exists for those who truly wish to learn. Enter at your own discretion.
        </div>
      </div>
    </section>

    <section class="token-grid">
      <div class="panel">
        <h3>Tokenomics</h3>
        <ul class="clean-list">
          <li><span>Supply:</span> <strong>1B</strong></li>
          <li><span>Liquidity:</span> <strong>Fair launch</strong></li>
          <li><span>Taxes:</span> <strong>0%</strong></li>
          <li><span>Allocation:</span> <strong>100% community</strong></li>
        </ul>
        <p class="muted">No utility except wisdom, memes, and the collective knowledge of ten thousand things. The only forbidden act: bringing war to the library.</p>
      </div>

      <div class="panel">
        <h3>How to Buy</h3>
        <ol class="steps">
          <li>Get SOL in your wallet (Phantom, Backpack).</li>
          <li>Open Jupiter and paste the Contract Address.</li>
          <li>Swap SOL ‚Üí <strong>$WanShiTong</strong>.</li>
          <li>Contribute knowledge. Share lore. Guard the archives.</li>
        </ol>
      </div>

      <div class="panel">
        <h3>Roadmap</h3>
        <div class="roadmap">
          <div class="milestone"><span>Phase I</span> The Library Opens (launch, community building, initial lore drops)</div>
          <div class="milestone"><span>Phase II</span> Knowledge Seekers Gather (raids, collaborations, expanded archives)</div>
          <div class="milestone"><span>Phase III</span> Ten Thousand Things (ongoing lore, community governance, eternal wisdom)</div>
        </div>
      </div>
    </section>

    <div class="knowledge-sections">
      <div class="section">
        <h2><span class="section-icon">
<svg viewBox="0 0 24 24" aria-hidden="true">
  <circle cx="12" cy="12" r="9"/>
  <path d="M8 10h8M8 13h8M8 16h5"/>
</svg>
</span> The Library's Guardian</h2>
        <p>Wan Shi Tong is an ancient knowledge spirit who built the greatest library in the world, hidden beneath the Si Wong Desert. For millennia, he collected knowledge from every corner of existence, demanding payment in unique information from all who enter. His towering form and countless eyes see through deception‚Äîhe knows when mortals seek knowledge for war.</p>
      </div>

      <div class="section">
        <h2><span class="section-icon">
<svg viewBox="0 0 24 24" aria-hidden="true">
  <circle cx="17" cy="7" r="1.5"/>
  <path d="M12 3a9 9 0 1 0 0 18"/>
</svg>
</span> Betrayal & Judgment</h2>
        <p>When Team Avatar sought planetary knowledge to defeat the Fire Nation, Wan Shi Tong saw through their intentions. Furious at being used as a weapon, he dragged his entire library into the Spirit World, declaring that humans could no longer be trusted. His judgment was absolute‚Äîthose who misuse knowledge face his wrath.</p>
      </div>

      <div class="section">
        <h2><span class="section-icon">
<svg viewBox="0 0 24 24" aria-hidden="true">
  <path d="M4 12a8 8 0 0 0 16 0"/>
  <path d="M12 4v3"/>
</svg>
</span> Spirit World Eternal</h2>
        <p>The library now exists beyond physical reach, in the Spirit World where time flows differently. Wan Shi Tong remains vigilant, aided by his knowledge seekers‚Äîfox spirits who once roamed the mortal world gathering information. His collection spans ten thousand things, from ancient scrolls to cosmic secrets, forever guarded by the one who knows all.</p>
      </div>
    </div>

    <div class="quote-section">
      <p class="quote">"You think you are the first person to believe their war was justified? Countless others before you have come here seeking weapons, weaknesses, battle strategies!"</p>
      <p class="quote-author">‚Äî Wan Shi Tong, to Professor Zei</p>
    </div>

    <div class="knowledge-form" id="memeLibrary">
      <h3>The Meme Library (Forbidden Pages)</h3>
      <p style="text-align: center; margin-bottom: 18px; opacity: 0.9;">
        No predictions. Only relics, receipts, and forbidden pages.
      </p>

      <div class="meme-frame">
        <img id="memeImg" alt="Forbidden Page" loading="lazy" />
      </div>

      <div class="submission-message" id="memeCaption" style="display:block; margin-top: 14px;"></div>

      <div class="meme-actions">
        <button type="button" class="btn small" id="memePrev">Prev</button>
        <button type="button" class="btn small" id="memeRandom">Random Page</button>
        <button type="button" class="btn small" id="memeNext">Next</button>
        <button type="button" class="btn small" id="memeCopy">Copy Caption</button>
        <button type="button" class="btn small" id="memeShare">Share on X</button>
      </div>
    </div>

    <section class="token-grid" id="spiritWorld" style="animation-delay: 1.1s;">
      <div class="panel" style="grid-column: 1 / -1;">
        <h3>Enter the Spirit World</h3>
        <p class="muted" style="margin-bottom: 18px;">
          No model. No loading. The Librarian appears when summoned.
        </p>

        <div class="sigil-wrap">
          <img id="spiritImg" src="wan-shi-tong.png" alt="Wan Shi Tong" loading="lazy" />
        </div>

        <div style="display:flex; gap: 10px; flex-wrap: wrap; margin-top: 14px;">
          <button type="button" class="btn" id="awakenBtn">Awaken the Librarian</button>
        </div>

<!-- ===== Spirit Run (Mini Game) ===== -->
<div class="wst-game" id="wstGame" style="margin-top: 18px;">
  <div class="wst-game-head">
    <div>
      <div class="wst-game-title">Spirit Run</div>
      <div class="muted" style="margin-top:6px;">Jump the flames ‚Ä¢ collect knowledge ‚Ä¢ survive the desert.</div>
    </div>
    <div class="wst-game-actions">
      <button type="button" class="btn small" id="wstGameStart">Start</button>
      <button type="button" class="btn small" id="wstGamePause" aria-pressed="false">Pause</button>
      <button type="button" class="btn small" id="wstGameReset">Reset</button>
    </div>
  </div>

  <canvas id="wstGameCanvas" width="900" height="260" aria-label="Spirit Run game canvas"></canvas>

  <div class="wst-game-hud">
    <div><span class="tag">ü¶â</span> <strong id="wstGameScore">0</strong> score</div>
    <div><span class="tag">üî•</span> <strong id="wstGameBest">0</strong> best</div>
    <div class="muted">Controls: <strong>Space</strong>/<strong>‚Üë</strong> jump ‚Ä¢ <strong>P</strong> pause</div>
  </div>
</div>
      </div>
    </section>
</div>

  <footer>
    <p>The Library exists beyond the physical realm, deep in the Spirit World</p>
    <p>Guarded eternally by Wan Shi Tong and his Knowledge Seekers</p>
    <p style="margin-top: 10px; opacity: 0.6;">

  <script>
    // ===== Floating Particles (Sand & Spirit Wisps) =====
    const particlesContainer = document.getElementById('floatingParticles');
    
    function createSandParticle() {
      const particle = document.createElement('div');
      particle.className = 'sand-particle';
      const size = Math.random() * 3 + 1;
      particle.style.width = size + 'px';
      particle.style.height = size + 'px';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.bottom = '-10px';
      particle.style.setProperty('--drift', (Math.random() - 0.5) * 100 + 'px');
      particle.style.animationDuration = (Math.random() * 15 + 20) + 's';
      particle.style.animationDelay = Math.random() * 5 + 's';
      particlesContainer.appendChild(particle);
      setTimeout(() => particle.remove(), 30000);
    }
    
    function createSpiritWisp() {
      const wisp = document.createElement('div');
      wisp.className = 'spirit-wisp';
      wisp.style.left = Math.random() * 100 + '%';
      wisp.style.top = Math.random() * 100 + '%';
      wisp.style.setProperty('--drift-x', (Math.random() - 0.5) * 300 + 'px');
      wisp.style.setProperty('--drift-y', (Math.random() - 0.5) * 300 + 'px');
      wisp.style.animationDuration = (Math.random() * 8 + 6) + 's';
      wisp.style.animationDelay = Math.random() * 3 + 's';
      particlesContainer.appendChild(wisp);
      setTimeout(() => wisp.remove(), 20000);
    }
    
    setInterval(createSandParticle, 2000);
    setInterval(createSpiritWisp, 5000);
    for(let i = 0; i < 8; i++) createSandParticle();
    for(let i = 0; i < 3; i++) createSpiritWisp();

    // ===== Live Price Ticker =====
    async function updatePrice() {
      try {
        const response = await fetch('https://api.dexscreener.com/latest/dex/pairs/solana/gb1dccxamrtdcw1zhhd6nu3mrdxalzdgyld8qfcr2mwn');
        const data = await response.json();
        const pair = (data && data.pairs && data.pairs[0]) ? data.pairs[0] : data.pair;

        if (pair && pair.priceUsd) {
          const price = parseFloat(pair.priceUsd);
          const change24h = parseFloat(pair.priceChange && pair.priceChange.h24 ? pair.priceChange.h24 : 0);

          document.getElementById('tickerPrice').textContent =
            '$' + (price < 0.01 ? price.toFixed(6) : price.toFixed(4));

          const changeEl = document.getElementById('tickerChange');
          const changeText = (change24h >= 0 ? '+' : '') + change24h.toFixed(2) + '%';
          changeEl.textContent = changeText + ' 24h';
          changeEl.className = 'ticker-change ' + (change24h >= 0 ? 'positive' : 'negative');
        }
      } catch (error) {
        console.log('Price fetch failed:', error);
        document.getElementById('tickerPrice').textContent = 'View Chart';
      }
    }
    
    updatePrice();
    setInterval(updatePrice, 30000);

    // ===== Stars with Parallax =====
    const starsContainer = document.getElementById('stars');
    const starElements = [];
    for (let i = 0; i < 100; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      const size = Math.random() * 3 + 1;
      star.style.width = size + 'px';
      star.style.height = size + 'px';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = Math.random() * 3 + 's';
      star.dataset.speed = (Math.random() * 0.3).toFixed(2);
      starsContainer.appendChild(star);
      starElements.push(star);
    }

    window.addEventListener('scroll', () => {
      const scrolled = window.pageYOffset;
      starElements.forEach(star => {
        const speed = parseFloat(star.dataset.speed);
        star.style.transform = `translateY(${scrolled * speed}px)`;
      });
    });

    // ===== 3D Owl Tilt Effect (throttled) =====
    const owlIcon = document.querySelector('.owl-icon');
    let rafId = null;
    function onMouseMove(e){
      if (!owlIcon) return;
      const x = (e.clientX / window.innerWidth - 0.5) * 15;
      const y = (e.clientY / window.innerHeight - 0.5) * 15;
      if (rafId) return;
      rafId = requestAnimationFrame(() => {
        owlIcon.style.transform = `perspective(1000px) rotateY(${x}deg) rotateX(${-y}deg)`;
        rafId = null;
      });
    }
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseleave', () => {
      if (owlIcon) owlIcon.style.transform = '';
    });

    // ===== Hover Lore Typewriter =====
    const loreLines = [
      "I am Wan Shi Tong, a Knowledge Spirit.",
      "I have collected information for over ten thousand years.",
      "Mortals always believe their cause is just.",
      "I was betrayed by those who sought knowledge for war.",
      "My library now exists in the Spirit World, beyond mortal reach.",
      "The foxes serve me, gathering knowledge across the realms.",
      "Those who misuse information face judgment.",
      "I see through all deception with my many eyes."
    ];

    const loreTextEl = document.getElementById('loreText');
    const loreTrigger = document.getElementById('loreTrigger');

    let loreIndex = 0;
    let typing = false;
    let typeTimer = null;

    function typeLine(line) {
      typing = true;
      loreTextEl.textContent = "";
      let i = 0;
      clearInterval(typeTimer);
      typeTimer = setInterval(() => {
        loreTextEl.textContent += line.charAt(i);
        i++;
        if (i >= line.length) {
          clearInterval(typeTimer);
          typing = false;
        }
      }, 25);
    }

    function nextLore() {
      if (typing) return;
      typeLine(loreLines[loreIndex % loreLines.length]);
      loreIndex++;
    }

    loreTrigger.addEventListener('mouseenter', nextLore);
    loreTrigger.addEventListener('focusin', nextLore);
    loreTrigger.addEventListener('click', () => {
      if (typing) {
        clearInterval(typeTimer);
        typing = false;
      } else {
        nextLore();
      }
    });

    typeLine(loreLines[0]);
    loreIndex = 1;

    // ===== Contract Address Copy =====
    const copyBtn = document.getElementById('copyCa');
    const caValue = document.getElementById('caValue');
    const copyStatus = document.getElementById('copyStatus');

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(caValue.textContent.trim());
        copyStatus.textContent = "Copied ‚úì";
        setTimeout(() => (copyStatus.textContent = ""), 1500);
      } catch (e) {
        copyStatus.textContent = "Copy failed";
        setTimeout(() => (copyStatus.textContent = ""), 2500);
      }
    });

    // ===== Social Share Buttons =====
    document.getElementById('shareTwitter').addEventListener('click', () => {
      const text = encodeURIComponent('He Who Knows Ten Thousand Things is about to teach the market a lesson ü¶â\\n\\n$WanShiTong\\nCA: DzmMSKtWmc2vhDxEcD5EH5Qr1MZNYJYZ8uE3UHaxpump');
      const url = encodeURIComponent(window.location.href);
      window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
    });

    document.getElementById('copyLink').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(window.location.href);
        const btn = document.getElementById('copyLink');
        const original = btn.textContent;
        btn.textContent = 'Copied ‚úì';
        setTimeout(() => btn.textContent = original, 1500);
      } catch (e) {
        alert('Failed to copy link');
      }
    });

    // ===== Section click feedback =====
    document.querySelectorAll('.section').forEach(section => {
      section.addEventListener('click', function() {
        this.style.background = 'rgba(61, 35, 20, 0.8)';
        setTimeout(() => {
          this.style.background = 'rgba(61, 35, 20, 0.6)';
        }, 200);
      });
    });

    // ===== Easter Egg =====
    let keySequence = [];
    const secretPhrase = 'sokka';
    window.addEventListener('keydown', (e) => {
      keySequence.push(e.key.toLowerCase());
      if (keySequence.length > secretPhrase.length) keySequence.shift();
      if (keySequence.join('') === secretPhrase) {
        alert('üó°Ô∏è Sokka: "So... this is the spirit that tried to keep us from the Fire Nation info. Knowledge guy, meat guy... we should talk."');
        keySequence = [];
      }
    });
  

    // ===== PFP / Meme Generator (Client-side Canvas) =====
(function() {
  const upload = document.getElementById('pfpUpload');
  const canvas = document.getElementById('pfpCanvas');
  const resetBtn = document.getElementById('pfpReset');
  const dlBtn = document.getElementById('pfpDownload');
  const textInput = document.getElementById('pfpText');
  const clearTextBtn = document.getElementById('pfpClearText');
  const stickerBar = document.getElementById('pfpStickers');
  const presetsBar = document.getElementById('pfpPresets');

  if (!upload || !canvas || !stickerBar) return;

  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  const state = {
    baseImg: null,
    baseCrop: { sx:0, sy:0, s:1 },
    textMode: 'bottom', // top | bottom | both
    frame: 'gold',      // none | gold | seal
    stickers: [],       // {img, x,y, w,h, rot, id, key}
    selectedId: null
  };

  const svgSticker = (svg) => 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));

  // Lore sticker pack (all inline SVG; no external assets; runs 100% client-side)
  const STICKERS = [
    { key: 'owl_eyes', label: 'Owl Eyes', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="360" height="180" viewBox="0 0 360 180">
      <defs>
        <radialGradient id="g" cx="50%" cy="50%" r="60%">
          <stop offset="0%" stop-color="#daa520" stop-opacity="0.95"/>
          <stop offset="55%" stop-color="#daa520" stop-opacity="0.35"/>
          <stop offset="100%" stop-color="#000" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <ellipse cx="110" cy="95" rx="88" ry="64" fill="rgba(0,0,0,0.35)" stroke="#daa520" stroke-width="10"/>
      <ellipse cx="250" cy="95" rx="88" ry="64" fill="rgba(0,0,0,0.35)" stroke="#daa520" stroke-width="10"/>
      <circle cx="110" cy="95" r="44" fill="url(#g)"/>
      <circle cx="250" cy="95" r="44" fill="url(#g)"/>
      <circle cx="110" cy="95" r="16" fill="rgba(0,0,0,0.7)"/>
      <circle cx="250" cy="95" r="16" fill="rgba(0,0,0,0.7)"/>
      <circle cx="102" cy="88" r="6" fill="rgba(255,255,255,0.5)"/>
      <circle cx="242" cy="88" r="6" fill="rgba(255,255,255,0.5)"/>
    </svg>`) },
    { key: 'sigil', label: 'Sigil', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220">
      <circle cx="110" cy="110" r="96" fill="rgba(0,0,0,0.45)" stroke="#daa520" stroke-width="10"/>
      <path d="M110 35 L145 95 L110 185 L75 95 Z" fill="none" stroke="#daa520" stroke-width="10" stroke-linejoin="round"/>
      <circle cx="110" cy="110" r="10" fill="#daa520"/>
    </svg>`) },
    { key: 'feather_crown', label: 'Feather Crown', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="360" height="210" viewBox="0 0 360 210">
      <path d="M55 165 C95 80, 140 80, 180 165 C220 80, 265 80, 305 165" fill="none" stroke="#daa520" stroke-width="12" stroke-linecap="round"/>
      <path d="M70 160 C90 120, 120 120, 140 160" fill="none" stroke="rgba(232,213,183,0.65)" stroke-width="8" stroke-linecap="round"/>
      <path d="M220 160 C240 120, 270 120, 290 160" fill="none" stroke="rgba(232,213,183,0.65)" stroke-width="8" stroke-linecap="round"/>
      <circle cx="180" cy="165" r="22" fill="rgba(0,0,0,0.35)" stroke="#daa520" stroke-width="10"/>
    </svg>`) },
    { key: 'scroll', label: 'Scroll', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="260" height="180" viewBox="0 0 260 180">
      <rect x="40" y="35" width="180" height="110" rx="16" fill="rgba(0,0,0,0.35)" stroke="#daa520" stroke-width="8"/>
      <path d="M70 70 H190" stroke="#e8d5b7" stroke-width="8" stroke-linecap="round" opacity="0.9"/>
      <path d="M70 95 H175" stroke="#e8d5b7" stroke-width="8" stroke-linecap="round" opacity="0.8"/>
      <path d="M70 120 H160" stroke="#e8d5b7" stroke-width="8" stroke-linecap="round" opacity="0.7"/>
      <circle cx="40" cy="90" r="22" fill="rgba(0,0,0,0.35)" stroke="#daa520" stroke-width="8"/>
      <circle cx="220" cy="90" r="22" fill="rgba(0,0,0,0.35)" stroke="#daa520" stroke-width="8"/>
    </svg>`) },
    { key: 'tome', label: 'Tome', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="260" height="220" viewBox="0 0 260 220">
      <rect x="55" y="35" width="150" height="160" rx="14" fill="rgba(0,0,0,0.45)" stroke="#daa520" stroke-width="10"/>
      <rect x="75" y="55" width="110" height="120" rx="10" fill="rgba(0,0,0,0.22)" stroke="rgba(218,165,32,0.4)" stroke-width="6"/>
      <path d="M130 72 V178" stroke="#daa520" stroke-width="8" opacity="0.9"/>
      <circle cx="130" cy="120" r="10" fill="#daa520"/>
    </svg>`) },
    { key: 'wax_seal', label: 'Wax Seal', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="260" height="260" viewBox="0 0 260 260">
      <circle cx="130" cy="130" r="110" fill="rgba(0,0,0,0.35)" stroke="#daa520" stroke-width="10"/>
      <circle cx="130" cy="130" r="78" fill="rgba(0,0,0,0.22)" stroke="rgba(218,165,32,0.35)" stroke-width="6"/>
      <text x="130" y="120" font-family="Georgia" font-size="22" text-anchor="middle" fill="#e8d5b7" opacity="0.9">THE LIBRARY</text>
      <text x="130" y="156" font-family="Georgia" font-size="18" text-anchor="middle" fill="#e8d5b7" opacity="0.75">REMEMBERS</text>
    </svg>`) },
    { key: 'chains', label: 'Chains', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="340" height="220" viewBox="0 0 340 220">
      <g fill="none" stroke="#daa520" stroke-width="10" opacity="0.9" stroke-linecap="round">
        <path d="M60 60 C95 25, 145 25, 180 60 C215 95, 215 145, 180 180 C145 215, 95 215, 60 180 C25 145, 25 95, 60 60 Z"/>
        <path d="M160 40 C195 5, 245 5, 280 40 C315 75, 315 125, 280 160 C245 195, 195 195, 160 160 C125 125, 125 75, 160 40 Z"/>
      </g>
      <path d="M140 110 H200" stroke="rgba(232,213,183,0.6)" stroke-width="8" stroke-linecap="round"/>
    </svg>`) },
    { key: 'hourglass', label: 'Hourglass', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="200" height="300" viewBox="0 0 200 300">
      <path d="M40 30 H160" stroke="#daa520" stroke-width="12" stroke-linecap="round"/>
      <path d="M40 270 H160" stroke="#daa520" stroke-width="12" stroke-linecap="round"/>
      <path d="M55 45 C70 120, 130 120, 145 45" fill="none" stroke="#daa520" stroke-width="10"/>
      <path d="M55 255 C70 180, 130 180, 145 255" fill="none" stroke="#daa520" stroke-width="10"/>
      <path d="M78 95 C92 120, 108 120, 122 95" fill="none" stroke="rgba(232,213,183,0.8)" stroke-width="8" stroke-linecap="round"/>
      <path d="M78 205 C92 180, 108 180, 122 205" fill="none" stroke="rgba(232,213,183,0.55)" stroke-width="8" stroke-linecap="round"/>
      <circle cx="100" cy="150" r="6" fill="rgba(232,213,183,0.75)"/>
    </svg>`) },
    { key: 'blindfold', label: 'Blindfold', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="360" height="140" viewBox="0 0 360 140">
      <rect x="30" y="50" width="300" height="50" rx="20" fill="rgba(0,0,0,0.55)" stroke="#daa520" stroke-width="8"/>
      <path d="M50 60 C80 20, 120 20, 150 60" fill="none" stroke="rgba(232,213,183,0.35)" stroke-width="6" stroke-linecap="round"/>
      <path d="M210 60 C240 20, 280 20, 310 60" fill="none" stroke="rgba(232,213,183,0.35)" stroke-width="6" stroke-linecap="round"/>
    </svg>`) },
    { key: 'spirit_fog', label: 'Spirit Fog', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="768" height="768" viewBox="0 0 768 768">
      <defs>
        <radialGradient id="f" cx="50%" cy="55%" r="70%">
          <stop offset="0%" stop-color="rgba(232,213,183,0.22)"/>
          <stop offset="60%" stop-color="rgba(232,213,183,0.10)"/>
          <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
        </radialGradient>
      </defs>
      <circle cx="384" cy="420" r="340" fill="url(#f)"/>
      <path d="M90 520 C180 460, 280 620, 380 560 C470 510, 560 610, 680 540" fill="none" stroke="rgba(232,213,183,0.12)" stroke-width="28" stroke-linecap="round"/>
      <path d="M120 600 C220 540, 320 700, 430 640 C520 590, 610 690, 720 620" fill="none" stroke="rgba(232,213,183,0.10)" stroke-width="24" stroke-linecap="round"/>
    </svg>`) },
    { key: 'star_map', label: 'Star Map', src: svgSticker(`<svg xmlns="http://www.w3.org/2000/svg" width="768" height="768" viewBox="0 0 768 768">
      <rect x="0" y="0" width="768" height="768" fill="rgba(0,0,0,0)"/>
      <g fill="#e8d5b7" opacity="0.22">
        <circle cx="120" cy="160" r="3"/><circle cx="180" cy="260" r="2"/><circle cx="310" cy="110" r="2"/>
        <circle cx="520" cy="220" r="3"/><circle cx="640" cy="140" r="2"/><circle cx="610" cy="340" r="2"/>
        <circle cx="420" cy="420" r="3"/><circle cx="250" cy="460" r="2"/><circle cx="140" cy="560" r="3"/>
        <circle cx="340" cy="640" r="2"/><circle cx="560" cy="610" r="3"/><circle cx="680" cy="520" r="2"/>
      </g>
      <g stroke="#daa520" opacity="0.18" stroke-width="3" fill="none">
        <path d="M120 160 L180 260 L310 110"/>
        <path d="M520 220 L640 140 L610 340"/>
        <path d="M140 560 L250 460 L420 420 L560 610 L680 520"/>
      </g>
    </svg>`) }
  ];

  function fitBaseImage(img) {
    const s = Math.min(img.width, img.height);
    const sx = (img.width - s) / 2;
    const sy = (img.height - s) / 2;
    state.baseCrop = { sx, sy, s };
  }

  function drawBase() {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fillRect(0, 0, W, H);
    if (!state.baseImg) return;
    const { sx, sy, s } = state.baseCrop;
    ctx.drawImage(state.baseImg, sx, sy, s, s, 0, 0, W, H);
  }

  function drawFrame() {
    if (state.frame === 'none') return;

    if (state.frame === 'gold') {
      const pad = 20;
      ctx.save();
      ctx.globalAlpha = 0.95;
      ctx.strokeStyle = '#daa520';
      ctx.lineWidth = 18;
      ctx.beginPath();
      ctx.arc(W/2, H/2, (Math.min(W,H)/2) - pad, 0, Math.PI*2);
      ctx.stroke();

      ctx.globalAlpha = 0.25;
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.arc(W/2, H/2, (Math.min(W,H)/2) - pad - 26, 0, Math.PI*2);
      ctx.stroke();
      ctx.restore();
    }

    if (state.frame === 'seal') {
      ctx.save();
      ctx.strokeStyle = '#daa520';
      ctx.globalAlpha = 0.95;
      ctx.lineWidth = 10;
      const m = 26;
      ctx.strokeRect(m, m, W - m*2, H - m*2);

      ctx.globalAlpha = 0.22;
      ctx.lineWidth = 3;
      ctx.strokeRect(m+18, m+18, W - (m+18)*2, H - (m+18)*2);

      ctx.globalAlpha = 0.9;
      ctx.lineWidth = 10;
      const c = 62;
      const drawCorner = (x,y,dx,dy) => {
        ctx.beginPath(); ctx.moveTo(x, y+dy*c); ctx.lineTo(x, y); ctx.lineTo(x+dx*c, y); ctx.stroke();
      };
      drawCorner(m, m, 1, 1);
      drawCorner(W-m, m, -1, 1);
      drawCorner(m, H-m, 1, -1);
      drawCorner(W-m, H-m, -1, -1);
      ctx.restore();
    }
  }

  function drawText() {
    const text = (textInput.value || '').trim();
    if (!text) return;

    ctx.save();
    ctx.textAlign = 'center';
    ctx.fillStyle = '#e8d5b7';
    ctx.strokeStyle = 'rgba(0,0,0,0.7)';
    ctx.lineWidth = 10;

    let fontSize = 64;
    const maxWidth = W * 0.86;
    do {
      ctx.font = `bold ${fontSize}px Georgia`;
      if (ctx.measureText(text).width <= maxWidth) break;
      fontSize -= 2;
    } while (fontSize > 28);

    const drawLine = (y) => {
      ctx.strokeText(text, W/2, y);
      ctx.fillText(text, W/2, y);
    };

    if (state.textMode === 'top' || state.textMode === 'both') drawLine(90);
    if (state.textMode === 'bottom' || state.textMode === 'both') drawLine(H - 60);

    ctx.restore();
  }

  function drawStickers() {
    for (const s of state.stickers) {
      ctx.save();
      ctx.translate(s.x, s.y);
      ctx.rotate(s.rot || 0);
      ctx.drawImage(s.img, -s.w/2, -s.h/2, s.w, s.h);

      if (s.id === state.selectedId) {
        ctx.strokeStyle = 'rgba(218,165,32,0.9)';
        ctx.lineWidth = 4;
        ctx.strokeRect(-s.w/2, -s.h/2, s.w, s.h);
      }
      ctx.restore();
    }
  }

  function render() {
    drawBase();
    drawStickers();
    drawFrame();
    drawText();
  }

  function addSticker(src, opts = {}) {
    const img = new Image();
    img.onload = () => {
      const base = Math.min(W, H);
      const defaultW = base * (opts.scale ?? 0.28);
      const w = Math.max(40, Math.min(W*0.9, defaultW));
      const h = Math.max(40, Math.min(H*0.9, w * (img.height / img.width)));
      const id = 'st_' + Math.random().toString(16).slice(2);
      const x = opts.x ?? (W/2);
      const y = opts.y ?? (H/2);
      const rot = opts.rot ?? 0;
      state.stickers.push({ img, x, y, w, h, rot, id, key: opts.key || '' });
      state.selectedId = id;
      render();
    };
    img.src = src;
  }

  // Sticker UI buttons
  STICKERS.forEach(st => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'btn small';
    btn.textContent = st.label;
    btn.addEventListener('click', () => addSticker(st.src, { key: st.key }));
    stickerBar.appendChild(btn);
  });

  // Presets (minimal, lore-forward)
  const PRESETS = [
    {
      label: 'The Librarian',
      apply() {
        state.stickers = [];
        state.selectedId = null;
        state.frame = 'gold';
        state.textMode = 'bottom';
        textInput.value = '$WanShiTong';
        // Seal + Sigil
        const seal = STICKERS.find(s => s.key === 'wax_seal');
        const sigil = STICKERS.find(s => s.key === 'sigil');
        if (seal) addSticker(seal.src, { key: seal.key, x: W*0.23, y: H*0.78, scale: 0.30 });
        if (sigil) addSticker(sigil.src, { key: sigil.key, x: W*0.78, y: H*0.78, scale: 0.24 });
        render();
      }
    },
    {
      label: 'Forbidden Knowledge',
      apply() {
        state.stickers = [];
        state.selectedId = null;
        state.frame = 'seal';
        state.textMode = 'both';
        textInput.value = 'THE LIBRARY REMEMBERS';
        const fog = STICKERS.find(s => s.key === 'spirit_fog');
        const starmap = STICKERS.find(s => s.key === 'star_map');
        const chains = STICKERS.find(s => s.key === 'chains');
        const scroll = STICKERS.find(s => s.key === 'scroll');
        if (starmap) addSticker(starmap.src, { key: starmap.key, x: W/2, y: H/2, scale: 0.98 });
        if (fog) addSticker(fog.src, { key: fog.key, x: W/2, y: H/2, scale: 0.98 });
        if (chains) addSticker(chains.src, { key: chains.key, x: W/2, y: H*0.78, scale: 0.62 });
        if (scroll) addSticker(scroll.src, { key: scroll.key, x: W*0.78, y: H*0.26, scale: 0.30 });
        render();
      }
    },
    {
      label: 'The Judge',
      apply() {
        state.stickers = [];
        state.selectedId = null;
        state.frame = 'gold';
        state.textMode = 'top';
        textInput.value = 'NO WAR IN THE LIBRARY';
        const blind = STICKERS.find(s => s.key === 'blindfold');
        const hour = STICKERS.find(s => s.key === 'hourglass');
        const seal = STICKERS.find(s => s.key === 'wax_seal');
        if (blind) addSticker(blind.src, { key: blind.key, x: W/2, y: H*0.36, scale: 0.62 });
        if (hour) addSticker(hour.src, { key: hour.key, x: W*0.82, y: H*0.60, scale: 0.30 });
        if (seal) addSticker(seal.src, { key: seal.key, x: W*0.20, y: H*0.78, scale: 0.28 });
        render();
      }
    },
    {
      label: 'The Archivist',
      apply() {
        state.stickers = [];
        state.selectedId = null;
        state.frame = 'seal';
        state.textMode = 'bottom';
        textInput.value = '$WanShiTong';
        const tome = STICKERS.find(s => s.key === 'tome');
        const crown = STICKERS.find(s => s.key === 'feather_crown');
        const eyes = STICKERS.find(s => s.key === 'owl_eyes');
        if (crown) addSticker(crown.src, { key: crown.key, x: W/2, y: H*0.16, scale: 0.64 });
        if (eyes) addSticker(eyes.src, { key: eyes.key, x: W/2, y: H*0.40, scale: 0.70 });
        if (tome) addSticker(tome.src, { key: tome.key, x: W*0.82, y: H*0.80, scale: 0.30 });
        render();
      }
    }
  ];

  if (presetsBar) {
    PRESETS.forEach(p => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'btn small';
      btn.textContent = p.label;
      btn.addEventListener('click', p.apply);
      presetsBar.appendChild(btn);
    });
  }

  // Upload
  upload.addEventListener('change', e => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const img = new Image();
    img.onload = () => {
      state.baseImg = img;
      fitBaseImage(img);
      state.stickers = [];
      state.selectedId = null;
      render();
    };
    img.src = URL.createObjectURL(file);
  });

  // Text mode buttons
  document.querySelectorAll('[data-textstyle]').forEach(btn => {
    btn.addEventListener('click', () => { state.textMode = btn.getAttribute('data-textstyle'); render(); });
  });

  // Frame buttons
  document.querySelectorAll('[data-frame]').forEach(btn => {
    btn.addEventListener('click', () => { state.frame = btn.getAttribute('data-frame'); render(); });
  });

  clearTextBtn.addEventListener('click', () => { textInput.value = ''; render(); });
  textInput.addEventListener('input', () => render());

  // Drag/select
  let dragging = false;
  let dragOffset = {x:0,y:0};

  function hitTest(x,y) {
    for (let i = state.stickers.length - 1; i >= 0; i--) {
      const s = state.stickers[i];
      // approximate AABB (ignoring rotation)
      if (x >= s.x - s.w/2 && x <= s.x + s.w/2 && y >= s.y - s.h/2 && y <= s.y + s.h/2) return s;
    }
    return null;
  }

  function getPos(ev) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = W / rect.width;
    const scaleY = H / rect.height;
    return { x: (ev.clientX - rect.left) * scaleX, y: (ev.clientY - rect.top) * scaleY };
  }

  canvas.addEventListener('mousedown', ev => {
    const p = getPos(ev);
    const s = hitTest(p.x,p.y);
    if (!s) { state.selectedId = null; render(); return; }
    state.selectedId = s.id;
    // bring to top
    state.stickers = state.stickers.filter(x => x.id !== s.id).concat([s]);
    dragging = true;
    dragOffset = { x: p.x - s.x, y: p.y - s.y };
    render();
  });

  window.addEventListener('mousemove', ev => {
    if (!dragging) return;
    const p = getPos(ev);
    const s = state.stickers.find(x => x.id === state.selectedId);
    if (!s) return;
    s.x = p.x - dragOffset.x;
    s.y = p.y - dragOffset.y;
    render();
  });

  window.addEventListener('mouseup', () => dragging = false);

  // Wheel to resize selected sticker
  canvas.addEventListener('wheel', ev => {
    const s = state.stickers.find(x => x.id === state.selectedId);
    if (!s) return;
    ev.preventDefault();
    const delta = Math.sign(ev.deltaY);
    const factor = delta > 0 ? 0.94 : 1.06;
    s.w = Math.max(40, Math.min(W*0.95, s.w * factor));
    s.h = Math.max(40, Math.min(H*0.95, s.h * factor));
    render();
  }, { passive: false });

  // Delete key removes selected sticker
  window.addEventListener('keydown', ev => {
    if (ev.key !== 'Delete' && ev.key !== 'Backspace') return;
    if (!state.selectedId) return;
    state.stickers = state.stickers.filter(s => s.id !== state.selectedId);
    state.selectedId = null;
    render();
  });

  // Reset
  resetBtn.addEventListener('click', () => {
    state.baseImg = null;
    state.stickers = [];
    state.selectedId = null;
    state.textMode = 'bottom';
    state.frame = 'gold';
    textInput.value = '$WanShiTong';
    upload.value = '';
    render();
  });

  // Download
  dlBtn.addEventListener('click', () => {
    render();
    const a = document.createElement('a');
    a.download = 'WanShiTong-PFP.png';
    a.href = canvas.toDataURL('image/png');
    a.click();
  });

  // First render
  render();
})();
  </script>

  <script>
    // ===== Meme Library + Spirit World (no 3D) =====
    (function () {
      // --- Meme Library ---
      const MEMES = [
        { src: "memes/page-001.jpg", text: "Page 001 ‚Äî Snowball season. Knowledge hits harder." },
        { src: "memes/page-002.jpg", text: "Page 002 ‚Äî Even the Library throws snowballs." },
        { src: "memes/page-003.jpg", text: "Page 003 ‚Äî He who knows ten thousand things knows your entry." },
        { src: "memes/page-004.jpg", text: "Page 004 ‚Äî Wings spread. Liquidity flees." },
        { src: "memes/page-005.jpg", text: "Page 005 ‚Äî The hunt is quiet. The receipts are loud." },
        { src: "memes/page-006.jpg", text: "Page 006 ‚Äî The Librarian watches the seeker." }
      ];

      let idx = 0;
      const img = document.getElementById("memeImg");
      const cap = document.getElementById("memeCaption");

      function renderMeme() {
        if (!img || !cap) return;
        const item = MEMES[idx] || MEMES[0];
        img.src = item.src;
        cap.textContent = item.text || "";
      }

      document.getElementById("memeNext")?.addEventListener("click", () => { idx = (idx + 1) % MEMES.length; renderMeme(); });
      document.getElementById("memePrev")?.addEventListener("click", () => { idx = (idx - 1 + MEMES.length) % MEMES.length; renderMeme(); });
      document.getElementById("memeRandom")?.addEventListener("click", () => { idx = Math.floor(Math.random() * MEMES.length); renderMeme(); });

      document.getElementById("memeCopy")?.addEventListener("click", async () => {
        const item = MEMES[idx] || {};
        const payload = (item.text || "").trim();
        try { await navigator.clipboard.writeText(payload); } catch (e) {}
      });

      document.getElementById("memeShare")?.addEventListener("click", () => {
        const item = MEMES[idx] || {};
        const tweet = encodeURIComponent((item.text || "").trim());
        const url = encodeURIComponent(window.location.href);
        window.open(`https://twitter.com/intent/tweet?text=${tweet}&url=${url}`, "_blank", "noopener,noreferrer");
      });

      renderMeme();

      // --- Spirit World (laser activation) ---
      const awakenBtn = document.getElementById("awakenBtn");
      const spiritImg = document.getElementById("spiritImg");
      const normalSrc = "wan-shi-tong.png";
      const laserSrc = "wan-shi-tong-laser.jpg";
      let coolingDown = false;

      function awaken(duration = 1200) {
        if (!spiritImg) return;
        spiritImg.src = laserSrc;
        spiritImg.classList.add("awakened");
        setTimeout(() => {
          spiritImg.src = normalSrc;
          spiritImg.classList.remove("awakened");
        }, duration);
      }

      awakenBtn?.addEventListener("click", () => {
        if (coolingDown) return;
        coolingDown = true;
        awaken(1200);
        setTimeout(() => { coolingDown = false; }, 1800);
      });
    })();
  

// ===== Spirit Run (Mini Game) =====
(function(){
  const canvas = document.getElementById('wstGameCanvas');
  const startBtn = document.getElementById('wstGameStart');
  const pauseBtn = document.getElementById('wstGamePause');
  const resetBtn = document.getElementById('wstGameReset');
  const scoreEl = document.getElementById('wstGameScore');
  const bestEl = document.getElementById('wstGameBest');

  if (!canvas || !startBtn || !pauseBtn || !resetBtn || !scoreEl || !bestEl) return;

  const ctx = canvas.getContext('2d');
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  let logicalW = canvas.width;
  let logicalH = canvas.height;

  function resizeCanvas(){
    // keep logical size stable, but render crisp on high DPI
    const cssW = canvas.clientWidth || 900;
    const cssH = Math.max(220, Math.min(280, Math.round(cssW * 0.28)));
    canvas.style.height = cssH + 'px';

    logicalW = Math.round(cssW * DPR);
    logicalH = Math.round(cssH * DPR);
    canvas.width = logicalW;
    canvas.height = logicalH;
  }
  resizeCanvas();
  window.addEventListener('resize', () => {
    resizeCanvas();
    draw(true);
  });

  const GROUND_RATIO = 0.82; // ground line
  const player = {
    x: 90,
    y: 0,
    vy: 0,
    r: 18 * DPR,
    onGround: true,
    emoji: 'ü¶â'
  };

  const flames = []; // obstacles
  let running = false;
  let paused = false;
  let score = 0;
  let best = 0;
  let tPrev = 0;

  const SPEED = 2.15 * DPR;         // slowed down
  const GRAV = 0.48 * DPR;          // gravity
  const JUMP = 10.6 * DPR;          // jump impulse (tuned)
  const MIN_GAP = 200 * DPR;        // fire spacing: minimum pixels between obstacles
  const SPAWN_MS_MIN = 1200;        // fire spacing: slower spawn cadence
  const SPAWN_MS_MAX = 1900;

  function loadBest(){
    try { best = parseInt(localStorage.getItem('wstGameBest') || '0', 10) || 0; } catch(_) { best = 0; }
    bestEl.textContent = best;
  }
  function saveBest(){
    try { localStorage.setItem('wstGameBest', String(best)); } catch(_) {}
  }
  loadBest();

  function groundY(){ return Math.floor(logicalH * GROUND_RATIO); }

  function reset(){
    flames.length = 0;
    score = 0;
    scoreEl.textContent = '0';
    player.y = groundY() - player.r;
    player.vy = 0;
    player.onGround = true;
    tPrev = 0;
    draw(true);
  }

  function randomInt(a,b){ return Math.floor(a + Math.random()*(b-a+1)); }

  let spawnTimer = null;
  function scheduleSpawn(){
    if (spawnTimer) clearTimeout(spawnTimer);
    const delay = randomInt(SPAWN_MS_MIN, SPAWN_MS_MAX);
    spawnTimer = setTimeout(() => {
      spawnFlame();
      if (running && !paused) scheduleSpawn();
    }, delay);
  }

  function spawnFlame(){
    const last = flames.length ? flames[flames.length - 1] : null;
    const startX = logicalW + 60 * DPR;
    if (last && (startX - last.x) < MIN_GAP) return;

    const h = randomInt(Math.floor(34*DPR), Math.floor(52*DPR)); // more "real" flame size variance
    flames.push({
      x: startX,
      w: Math.floor(28*DPR),
      h,
      emoji: 'üî•',
      passed: false
    });
  }

  function jump(){
    if (!running || paused) return;
    if (player.onGround){
      player.vy = -JUMP;
      player.onGround = false;
    }
  }

  function togglePause(force){
    if (!running) return;
    paused = typeof force === 'boolean' ? force : !paused;
    pauseBtn.setAttribute('aria-pressed', paused ? 'true' : 'false');
    pauseBtn.textContent = paused ? 'Resume' : 'Pause';

    if (!paused){
      tPrev = performance.now();
      scheduleSpawn();
      requestAnimationFrame(loop);
    } else {
      if (spawnTimer) clearTimeout(spawnTimer);
    }
    draw(true);
  }

  function stopGame(reason){
    running = false;
    paused = false;
    if (spawnTimer) clearTimeout(spawnTimer);
    if (score > best){
      best = score;
      bestEl.textContent = best;
      saveBest();
    }
    // flash a small message
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.55)';
    ctx.fillRect(0,0,logicalW,logicalH);
    ctx.fillStyle = '#f6d57a';
    ctx.font = `${Math.floor(22*DPR)}px Georgia, serif`;
    ctx.textAlign = 'center';
    ctx.fillText(reason || 'The Librarian judges you.', logicalW/2, logicalH/2 - 10*DPR);
    ctx.font = `${Math.floor(14*DPR)}px Georgia, serif`;
    ctx.fillStyle = 'rgba(255,255,255,0.85)';
    ctx.fillText('Press Start to try again.', logicalW/2, logicalH/2 + 18*DPR);
    ctx.restore();
  }

  function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  }

  // draw a simple "more real" backdrop: dune line + drifting embers
  const embers = Array.from({length: 22}, () => ({
    x: Math.random(),
    y: Math.random(),
    s: 0.3 + Math.random()*0.9,
    a: 0.05 + Math.random()*0.15
  }));

  function draw(force){
    ctx.clearRect(0,0,logicalW,logicalH);

    // sky shimmer
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.fillStyle = 'rgba(0,0,0,0.0)';
    ctx.fillRect(0,0,logicalW,logicalH);

    // dune / ground
    const gy = groundY();
    ctx.globalAlpha = 0.9;
    ctx.fillStyle = 'rgba(139,105,20,0.22)';
    ctx.beginPath();
    ctx.moveTo(0, gy);
    const bump = Math.floor(22*DPR);
    for (let x=0; x<=logicalW; x+=Math.floor(80*DPR)){
      const y = gy + Math.sin((x/160)*Math.PI)*bump;
      ctx.lineTo(x, y);
    }
    ctx.lineTo(logicalW, logicalH);
    ctx.lineTo(0, logicalH);
    ctx.closePath();
    ctx.fill();

    // ground line
    ctx.globalAlpha = 0.65;
    ctx.strokeStyle = 'rgba(246,213,122,0.35)';
    ctx.lineWidth = Math.max(1, Math.floor(2*DPR));
    ctx.beginPath();
    ctx.moveTo(0, gy);
    ctx.lineTo(logicalW, gy);
    ctx.stroke();

    // embers (subtle)
    ctx.globalAlpha = 1;
    for (const e of embers){
      const ex = e.x * logicalW;
      const ey = e.y * gy;
      ctx.fillStyle = `rgba(255,180,80,${e.a})`;
      ctx.beginPath();
      ctx.arc(ex, ey, e.s*DPR, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    // player (emoji style)
    ctx.save();
    ctx.font = `${Math.floor(40*DPR)}px Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.shadowColor = 'rgba(255,255,255,0.15)';
    ctx.shadowBlur = 14 * DPR;
    ctx.fillText(player.emoji, player.x, player.y);
    ctx.restore();

    // flames
    for (const f of flames){
      const fx = f.x;
      const fy = groundY() - f.h/2;
      ctx.save();
      ctx.font = `${Math.floor(44*DPR)}px Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.shadowColor = 'rgba(255,90,0,0.25)';
      ctx.shadowBlur = 22 * DPR;
      ctx.fillText(f.emoji, fx, fy);
      ctx.restore();
    }

    // overlay (paused)
    if (running && paused){
      ctx.save();
      ctx.fillStyle = 'rgba(0,0,0,0.45)';
      ctx.fillRect(0,0,logicalW,logicalH);
      ctx.fillStyle = '#f6d57a';
      ctx.font = `${Math.floor(20*DPR)}px Georgia, serif`;
      ctx.textAlign = 'center';
      ctx.fillText('Paused', logicalW/2, logicalH/2);
      ctx.restore();
    }
  }

  function update(dt){
    // player physics
    player.vy += GRAV;
    player.y += player.vy;

    const gy = groundY() - player.r;
    if (player.y >= gy){
      player.y = gy;
      player.vy = 0;
      player.onGround = true;
    }

    // move obstacles
    for (const f of flames){
      f.x -= SPEED * (dt/16.67);
      // score passing
      if (!f.passed && f.x < player.x - 10*DPR){
        f.passed = true;
        score += 1;
        scoreEl.textContent = String(score);
      }
    }
    // cleanup
    while (flames.length && flames[0].x < -120*DPR) flames.shift();

    // collision check (simple bbox)
    const pW = 34 * DPR;
    const pH = 34 * DPR;
    const pX = player.x - pW/2;
    const pY = player.y - pH/2;

    for (const f of flames){
      const fW = 34 * DPR;
      const fH = f.h;
      const fX = f.x - fW/2;
      const fY = groundY() - fH;

      if (rectsOverlap(pX,pY,pW,pH,fX,fY,fW,fH)){
        stopGame('The fire consumes the knowledge.');
        return false;
      }
    }

    // animate embers drift
    for (const e of embers){
      e.x -= 0.0004 * (dt/16.67);
      e.y += 0.0002 * (dt/16.67);
      if (e.x < -0.05) e.x = 1.05;
      if (e.y > 1.05) e.y = -0.05;
    }

    return true;
  }

  function loop(t){
    if (!running || paused) return;
    if (!tPrev) tPrev = t;
    const dt = Math.min(48, t - tPrev);
    tPrev = t;

    const ok = update(dt);
    draw(false);
    if (ok) requestAnimationFrame(loop);
  }

  function start(){
    reset();
    running = true;
    paused = false;
    pauseBtn.setAttribute('aria-pressed','false');
    pauseBtn.textContent = 'Pause';
    tPrev = performance.now();
    scheduleSpawn();
    requestAnimationFrame(loop);
  }

  // controls
  startBtn.addEventListener('click', start);
  resetBtn.addEventListener('click', reset);
  pauseBtn.addEventListener('click', () => togglePause());

  window.addEventListener('keydown', (e) => {
    const k = e.key.toLowerCase();
    if (k === ' ' || k === 'arrowup'){
      e.preventDefault();
      if (!running) start();
      jump();
    } else if (k === 'p'){
      togglePause();
    }
  }, { passive: false });

  // first paint
  reset();
})();
</script>

<!-- === WST Portal Overlay (additive) === -->
<button class="wst-portal-btn" id="wstPortalBtn" type="button">ENTER THE LIBRARY</button>

<div class="wst-portal" id="wstPortal" aria-hidden="true">
  <div class="wst-portal-backdrop" data-close="1"></div>
  <div class="wst-portal-shell" role="dialog" aria-modal="true" aria-label="Wan Shi Tong Portal">
    <div class="wst-portal-top">
      <div class="wst-portal-title">
        <strong>WAN SHI TONG ‚Äî KNOWLEDGE VAULT</strong>
        <span>Portal mode. A concentrated mirror of the Library.</span>
      </div>
      <button class="wst-portal-close" id="wstPortalClose" type="button">Close (Esc)</button>
    </div>

    <div class="wst-portal-body">
      <div class="wst-portal-tabs" role="tablist" aria-label="Portal Tabs">
        <button class="wst-portal-tab" role="tab" aria-selected="true"  data-tab="vault">Daily Vault</button>
        <button class="wst-portal-tab" role="tab" aria-selected="false" data-tab="memes">Forbidden Pages</button>
        <button class="wst-portal-tab" role="tab" aria-selected="false" data-tab="spirit">Spirit Gate</button></div>
      <div class="wst-portal-content" id="wstPortalContent"></div>
    </div>
  </div>
</div>


<script>
(() => {
  // ===== WST Portal (additive; non-destructive) =====
  const portalBtn = document.getElementById('wstPortalBtn');
  const portal = document.getElementById('wstPortal');
  const closeBtn = document.getElementById('wstPortalClose');
  const content = document.getElementById('wstPortalContent');
  const tabs = Array.from(portal.querySelectorAll('.wst-portal-tab'));

  function setPortal(open){
    portal.setAttribute('aria-hidden', open ? 'false' : 'true');
    portal.classList.toggle("open", open);
    document.body.style.overflow = open ? 'hidden' : '';
    if(open){
      renderTab('vault');
      tabs.forEach(t => t.setAttribute('aria-selected', t.dataset.tab === 'vault' ? 'true' : 'false'));
    }
  }

  function cloneSection(selector){
    const el = document.querySelector(selector);
    if(!el) return null;
    const c = el.cloneNode(true);
    // Remove any IDs to avoid duplicates in the mirror
    c.querySelectorAll('[id]').forEach(n => n.removeAttribute('id'));
    return c;
  }

  // Daily Vault (local only)
  const VAULT_KEY = 'wst_daily_vault_v1';
  const todayKey = new Date().toISOString().slice(0,10);
  const vaultData = {
    prophecy: [
      "A chart may climb, but the library remembers the wick.",
      "When the crowd chants, count the exits ‚Äî and the entrances.",
      "The owl blinks once for patience, twice for profit, thrice for ruin."
    ],
    lore: [
      "In the Si Wong sands, knowledge is a tax ‚Äî paid in truth, not coin.",
      "A library moved to the Spirit World cannot be rugged by mortals.",
      "He who hoards secrets becomes the secret."
    ],
    mantra: [
      "Slow hands. Sharp eyes. No mercy for noise.",
      "Seek receipts. Ignore theater.",
      "Be early, be small, be ruthless with risk."
    ],
    quest: [
      "Find one overlooked detail in the chart, then do nothing for 10 minutes.",
      "Share one meme page with a caption that sounds like scripture.",
      "Write a single sentence: why you are in this trade ‚Äî keep it pinned."
    ]
  };

  function getDailyVault(){
    try{
      const raw = localStorage.getItem(VAULT_KEY);
      if(!raw) return null;
      const obj = JSON.parse(raw);
      if(obj?.date === todayKey) return obj;
      return null;
    }catch(e){ return null; }
  }
  function setDailyVault(obj){
    try{ localStorage.setItem(VAULT_KEY, JSON.stringify(obj)); }catch(e){}
  }

  function renderVault(){
    const existing = getDailyVault();
    let item = existing;

    const wrap = document.createElement('div');
    wrap.className = 'wst-vault-card';
    const title = document.createElement('h3');
    title.textContent = 'Wan Shi Tong‚Äôs Daily Vault';
    title.style.margin = '0 0 10px 0';
    wrap.appendChild(title);

    const out = document.createElement('div');
    out.id = 'wstVaultOutput';
    out.style.whiteSpace = 'pre-wrap';
    out.style.lineHeight = '1.45';
    out.style.opacity = '0.95';
    out.textContent = item ? `TYPE: ${item.type.toUpperCase()}\n\n${item.text}` : 'The vault is sealed. Reveal today‚Äôs page.';
    wrap.appendChild(out);

    const note = document.createElement('div');
    note.className = 'wst-portal-note';
    note.textContent = 'One reveal per day (local browser). Clearly satire / for entertainment.';
    wrap.appendChild(note);

    const actions = document.createElement('div');
    actions.className = 'wst-vault-actions';

    const revealBtn = document.createElement('button');
    revealBtn.className = 'wst-mini-btn';
    revealBtn.type = 'button';
    revealBtn.textContent = item ? 'Vault Sealed (Come Back Tomorrow)' : 'Reveal Today‚Äôs Page';
    revealBtn.disabled = !!item;

    revealBtn.addEventListener('click', () => {
      if(item) return;
      const types = Object.keys(vaultData);
      const type = types[Math.floor(Math.random()*types.length)];
      const list = vaultData[type];
      const text = list[Math.floor(Math.random()*list.length)];
      item = { date: todayKey, type, text };
      setDailyVault(item);
      out.textContent = `TYPE: ${item.type.toUpperCase()}\n\n${item.text}`;
      revealBtn.textContent = 'Vault Sealed (Come Back Tomorrow)';
      revealBtn.disabled = true;
    });

    const copyBtn = document.createElement('button');
    copyBtn.className = 'wst-mini-btn';
    copyBtn.type = 'button';
    copyBtn.textContent = 'Copy';
    copyBtn.addEventListener('click', async () => {
      const txt = out.textContent || '';
      try{ await navigator.clipboard.writeText(txt); copyBtn.textContent = 'Copied'; setTimeout(()=>copyBtn.textContent='Copy', 900); }catch(e){}
    });

    const shareBtn = document.createElement('button');
    shareBtn.className = 'wst-mini-btn';
    shareBtn.type = 'button';
    shareBtn.textContent = 'Share on X';
    shareBtn.addEventListener('click', () => {
      const txt = out.textContent || '';
      const url = 'https://x.com/intent/tweet?text=' + encodeURIComponent(txt + "\n\n$WanShiTong");
      window.open(url, '_blank', 'noopener,noreferrer');
    });

    actions.appendChild(revealBtn);
    actions.appendChild(copyBtn);
    actions.appendChild(shareBtn);
    wrap.appendChild(actions);
    return wrap;
  }

  function renderTab(tab){
    content.innerHTML = '';
    if(tab === 'vault'){
      content.appendChild(renderVault());
      return;
    }

    if(tab === 'memes'){
      const m = cloneSection('#memeLibrary') || cloneSection('[data-section="memeLibrary"]');
      if(m) content.appendChild(m);
      const note = document.createElement('div');
      note.className = 'wst-portal-note';
      note.textContent = 'Forbidden Pages mirror. For full interactions, use the main page.';
      content.appendChild(note);
      return;
    }

    if(tab === 'spirit'){
      const s = cloneSection('#spiritWorld') || cloneSection('[data-section="spiritWorld"]');
      if(s) content.appendChild(s);
      const note = document.createElement('div');
      note.className = 'wst-portal-note';
      note.textContent = 'Spirit Gate mirror. The original controls remain on the main page.';
      content.appendChild(note);
      return;
    }
  }

  // Tab events
  tabs.forEach(btn => {
    btn.addEventListener('click', () => {
      tabs.forEach(t => t.setAttribute('aria-selected', t === btn ? 'true' : 'false'));
      renderTab(btn.dataset.tab);
    });
  });

  // Open / close
  portalBtn?.addEventListener('click', () => setPortal(true));
  closeBtn?.addEventListener('click', () => setPortal(false));
  portal?.addEventListener('click', (e) => {
    const t = e.target;
    if (t && t.getAttribute('data-close') === '1') setPortal(false);
  });
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && portal.getAttribute('aria-hidden') === 'false') setPortal(false);
  });

  // Subtle parallax drift (no layout changes)
  const root = document.documentElement;
  window.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth - 0.5) * 2;
    const y = (e.clientY / window.innerHeight - 0.5) * 2;
    root.style.setProperty('--wst-parallax-x', (x * 6).toFixed(2) + 'px');
    root.style.setProperty('--wst-parallax-y', (y * 6).toFixed(2) + 'px');
  }, { passive: true });

})();
</script>

</body>
</html>
